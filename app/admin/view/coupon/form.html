{extend name="main" /}
{block name="body"}

<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">添加优惠券</div>
                <div class="layui-card-body" pad15="">
                    <div class="layui-form" lay-filter="layuiadmin-app-form-list" id="layuiadmin-app-form-list" style="padding: 20px 30px 0 0;">
                        <form action="{:request()->url()}" method="post" class="xn_ajax" data-type="open">
                            <div class="layui-form-item">
                                <label class="layui-form-label">券类型</label>
                                <div class="layui-input-block">
                                    <select name="stock_type" lay-filter="stock-type-filter">
                                        <option value="NORMAL" selected>满减券</option>
                                        <option value="DISCOUNT" >折扣券</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">批次名称</label>
                                <div class="layui-input-block">
                                    <input type="text" name="stock_name" lay-verify="required" placeholder="" autocomplete="off" class="layui-input" value="{$coupon_data.stock_name}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">商品范围</label>
                                <div class="layui-input-block">
                                    <input type="text" name="goods_name" placeholder="" autocomplete="off" class="layui-input" value="{$coupon_data.goods_name}">
                                </div>
                            </div>

                            <!-- 满减券区块 -->
                            <div id="NORMAL_BLOCK" style="display: none">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">优惠金额</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="discount_amount" placeholder="" autocomplete="off" class="layui-input" value="{$coupon_data.discount_amount}">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">消费门槛</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="n_transaction_minimum" placeholder="" autocomplete="off" class="layui-input" value="{$coupon_data.transaction_minimum}">
                                    </div>
                                </div>
                            </div>
                            <!-- 满减券区块 -->

                            <!-- 折扣券区块 -->
                            <div id="DISCOUNT_BLOCK" style="display: none">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">折扣比例</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="discount_percent" placeholder="" autocomplete="off" class="layui-input" value="{$coupon_data.discount_percent}">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">消费门槛</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="d_transaction_minimum" placeholder="" autocomplete="off" class="layui-input" value="{$coupon_data.transaction_minimum}">
                                    </div>
                                </div>
                            </div>
                            <!-- 折扣券区块 -->


                            <div class="layui-form-item">
                                <label class="layui-form-label">券可核销开始时间</label>
                                <div class="layui-input-block">
                                    <input type="text" id="available_begin_time" name="available_begin_time" placeholder="" autocomplete="off" class="layui-input" lay-verify="date" value="{$coupon_data.available_begin_time}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">券可核销结束时间</label>
                                <div class="layui-input-block">
                                    <input type="text" id="available_end_time" name="available_end_time" placeholder="" autocomplete="off" class="layui-input" lay-verify="date" value="{$coupon_data.available_end_time}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">生效后N天内有效</label>
                                <div class="layui-input-block">
                                    <input type="text" name="available_day_after_receive" placeholder="" autocomplete="off" class="layui-input" value="{$coupon_data.available_day_after_receive}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">批次最大发放个数</label>
                                <div class="layui-input-block">
                                    <input type="text" name="max_coupons" placeholder="" autocomplete="off" class="layui-input" value="{$coupon_data.max_coupons}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">用户最大可领个数</label>
                                <div class="layui-input-block">
                                    <input type="text" name="max_coupons_per_user" placeholder="" autocomplete="off" class="layui-input" value="{$coupon_data.max_coupons_per_user}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">是否开启自然人限制</label>
                                <div class="layui-input-block">
                                    <input type="checkbox" lay-verify="required" lay-filter="status" name="natural_person_limit" lay-skin="switch" lay-text="开启|关闭" value="1" {if condition="$coupon_data['status'] eq 1"}checked{/if} >
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">可疑账号拦截</label>
                                <div class="layui-input-block">
                                    <input type="checkbox" lay-verify="required" lay-filter="status" name="prevent_api_abuse" lay-skin="switch" lay-text="开启|关闭" value="1" {if condition="$coupon_data['status'] eq 1"}checked{/if} >
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">使用须知</label>
                                <div class="layui-input-block">
                                    <input type="text" name="description" placeholder="" autocomplete="off" class="layui-input" value="">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">状态</label>
                                <div class="layui-input-block">
                                    <input type="checkbox" lay-verify="required" lay-filter="status" name="status" lay-skin="switch" lay-text="正常|禁止" value="1" {if condition="$coupon_data['status'] eq 1"}checked{/if} >
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <button type="submit" class="layui-btn">保存</button>
                                </div>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>




{/block}

{block name="js"}
<script>
    layui.use(['laydate','form'], function(){
        var laydate = layui.laydate;
        var form = layui.form;
        laydate.render({
            elem: '#available_begin_time'
        });
        laydate.render({
            elem: '#available_end_time'
        });
        // 初始化select

        var stock_type = "{$coupon_data.stock_type}";
        if(stock_type == 'DISCOUNT'){
            $('#NORMAL_BLOCK').css('display','none');
            $('#DISCOUNT_BLOCK').css('display','block');
        }else{
            $('#NORMAL_BLOCK').css('display','block');
            $('#DISCOUNT_BLOCK').css('display','none');
        }


        // select 事件
        form.on('select(stock-type-filter)', function(data){
            var elem = data.elem; // 获得 select 原始 DOM 对象
            var value = data.value; // 获得被选中的值
            var othis = data.othis; // 获得 select 元素被替换后的 jQuery 对象
            layer.msg(this.innerHTML + ' 的 value: '+ value); // this 为当前选中 <option> 元素对象
            if(value == 'NORMAL'){
                $('#NORMAL_BLOCK').css('display','block');
                $('#DISCOUNT_BLOCK').css('display','none');
            }else{
                $('#NORMAL_BLOCK').css('display','none');
                $('#DISCOUNT_BLOCK').css('display','block');
            }
        });
    });
</script>
{/block}